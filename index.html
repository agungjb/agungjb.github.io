<!-- ==============================
     BIO LINK ULTRA MINIMAL B/W
     SIAP PASTE DI BLOGGER POST
     =============================== -->

<!-- ========== CONFIG (EDIT DI SINI SAJA) ========== -->
<script>
  const BIO_CONFIG = {
    /* 1. ID GTM / DataLayer */
    gtmId: "GTM-WTZLWJSR",

    /* 2. Popup marketing "Gratis Biolink" */
    popup: {
      enabled: true,
      title: "Dapatkan biolink ini secara gratis",
      description: "Masukkan nama, email, dan WhatsApp kamu untuk menerima biolink ini.",
      openCtaText: "Gratis",
      submitButtonText: "Kirim",
      successTitle: "Terimakasih!",
      successBody: "Biolink ini akan dikirim ke kamu, silahkan cek notifikasi WhatsApp atau email.",
      buttonColor: "#000000",
      buttonTextColor: "#ffffff"
    },

    /* 3. Profile */
    profile: {
      avatar: "https://lh3.googleusercontent.com/a/ACg8ocJ7cMujo1yh0vOPsMuB0ZambMHCLUMApaTPaGjCIXMRhSZdt6A=s576-c-no",
      username: "guenk",
      bio: "halo nice to meet you"
    },

    /* 4 & 6. Social media (aktif pakai true/false) */
    socials: [
      {
        active: true,
        platform: "tiktok",
        label: "TikTok",
        url: "https://www.tiktok.com/@guenk.xyz",
        icon: "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg"
      },
      {
        active: true,
        platform: "instagram",
        label: "Instagram",
        url: "https://www.instagram.com/guenk.xyz?igsh=N3VuMTNmaTh6dTk3",
        icon: "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg"
      },
      {
        active: true,
        platform: "youtube",
        label: "YouTube",
        url: "https://www.youtube.com/@Guenkxyz",
        icon: "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/youtube.svg"
      },
      {
        active: true,
        platform: "facebook",
        label: "Facebook",
        url: "https://www.facebook.com/share/1Et8fFd7or/",
        icon: "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg"
      },
      {
        active: true,
        platform: "threads",
        label: "Threads",
        url: "https://www.threads.com/@guenk.xyz",
        icon: "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/threads.svg"
      },
      {
        active: true,
        platform: "twitter",
        label: "X (Twitter)",
        url: "https://x.com/Guenk_xyz",
        icon: "https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg"
      }
    ],

    /* 7. Form Any Question + reCAPTCHA */
    forms: {
      googleFormId: "1FAIpQLSf6r7MhZ-4csP1O5Nqf5Fl25Qlb1TzKaK1zYXPybj1bt4x62Q",
      entry: {
        name: "entry.1806687588",      // nama
        email: "entry.791269284",      // email (ini yang bener buat email)
        whatsapp: "entry.31252103",    // whatsapp
        question: "entry.586171816"    // question (khusus form "Any question")
      },
      recaptchaSiteKey: "ISI_SITE_KEY_RECAPTCHA_KAMU" // TODO: ganti dengan site key reCAPTCHA v2 kamu
    },

    /* 8. Link list (aktif pakai true/false)
       Logika:
       - Kalau SEMUA active = false atau kosong,
         maka social media akan dipakai sebagai link list,
         dan barisan icon social di atas akan disembunyikan.
    */
    linkList: [
      {
        active: true,
        title: "ðŸ‘‰ guenk.xyz",
        url: "https://guenk.xyz",
        icon: "" // optional, bisa kosong, icon pakai emoji di title juga oke
      },
      {
        active: true,
        title: "ðŸ«µ Google",
        url: "https://google.com",
        icon: ""
      },
      {
        active: true,
        title: "ðŸ–• Bio Link",
        url: "https://bio.link",
        icon: ""
      },
      {
        active: true,
        title: "ðŸ‘† Canva",
        url: "https://canva.com",
        icon: ""
      },
      {
        active: true,
        title: "ðŸ‘‡ Biolink",
        url: "https://biolink.org",
        icon: ""
      },
      {
        active: true,
        title: "ðŸ–• Hosteko",
        url: "https://hosteko.com",
        icon: ""
      }
    ],

    /* 9. Search produk */
    productSearch: {
      label: "Cari disini"
    },

    /* 10. Produk (bisa ditambah / edit) */
    products: [
      {
        title: "Botol Minuman",
        url: "https://s.shopee.co.id/AUnrfjNE4U",
        image: "https://down-id.img.susercontent.com/file/id-11134207-81ztp-mfar4bifbrpo92.webp",
        price: "Gratis",
        category: "Gratis"
      },
      {
        title: "Tripod",
        url: "https://s.shopee.co.id/3fxXXLmzRO",
        image: "https://down-id.img.susercontent.com/file/id-11134207-8224s-mj05x727x8g59e@resize_w750_nl.webp",
        price: "Gratis",
        category: "Gratis"
      },
      {
        title: "Extra Jas Hujan",
        url: "https://s.shopee.co.id/4q9UveEalW",
        image: "https://down-id.img.susercontent.com/file/id-11134207-81ztl-mfh6eu93i9l5af.webp",
        price: "75k",
        category: "Outdoor"
      },
      {
        title: "Satu Set Pancing â€“ Newtrek Raincoat Omuro Series",
        url: "https://s.shopee.co.id/70DzVlFYTW",
        image: "https://down-id.img.susercontent.com/file/id-11134207-7r98q-lx0k6dqu31nu92.webp",
        price: "50k",
        category: "Outdoor"
      },
      {
        title: "Satu Set Pancing",
        url: "https://s.shopee.co.id/6KyIioy6Ve",
        image: "https://down-id.img.susercontent.com/file/id-11134207-7r98z-lqm0ms7s0xdy67.webp",
        price: "15k",
        category: "Outdoor"
      }
    ],

    /* 11. Footer */
    footer: {
      text: "2026 by Aguenk. All rights reserved."
    }
  };
</script>

<!-- ========== STYLE (HITAM PUTIH ULTRA MINIMAL) ========== -->
<style>
  .biolink-body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background:#ffffff;
    color:#000000;
  }
  .biolink-wrap {
    max-width: 480px;
    margin: 0 auto;
    padding: 24px 16px 80px;
    background:#ffffff;
  }

  * {
    box-sizing:border-box;
  }

  .b-card {
    border:1px solid #000;
    border-radius:16px;
    padding:16px;
    background:#fff;
  }

  /* Profile */
  .profile {
    text-align:center;
    margin-bottom:16px;
  }
  .profile-avatar {
    width:96px;
    height:96px;
    border-radius:50%;
    border:2px solid #000;
    object-fit:cover;
    display:block;
    margin:0 auto 10px;
  }
  .profile-username {
    font-weight:700;
    font-size:1.2rem;
    margin-bottom:4px;
  }
  .profile-bio {
    font-size:.9rem;
    opacity:.85;
  }

  /* Popup CTA button di dekat profile */
  .popup-cta-btn {
    margin-top:12px;
    padding:8px 16px;
    border-radius:999px;
    border:1px solid #000;
    font-size:.85rem;
    font-weight:600;
    cursor:pointer;
    background:#000;
    color:#fff;
  }

  /* Social icons row */
  .social-row {
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    gap:8px;
    margin:16px 0;
  }
  .social-row.hidden {
    display:none;
  }
  .social-link {
    width:34px;
    height:34px;
    border-radius:50%;
    border:1px solid #000;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .social-link img {
    width:18px;
    height:18px;
    display:block;
  }

  /* Search section + back to top */
  .search-card {
    margin-bottom:16px;
  }
  .search-label {
    font-size:.85rem;
    margin-bottom:6px;
    font-weight:600;
  }
  .search-input {
    width:100%;
    padding:8px 10px;
    border-radius:999px;
    border:1px solid #000;
    font-size:.85rem;
    background:#fff;
    color:#000;
  }

  .backToTopBtn {
    margin-top:8px;
    border-radius:999px;
    border:1px solid #000;
    background:#000;
    color:#fff;
    padding:6px 14px;
    font-size:.8rem;
    cursor:pointer;
  }
  body.show-backtotop .backToTopBtn {
    position:fixed;
    left:50%;
    transform:translateX(-50%);
    bottom:16px;
    z-index:50;
  }

  /* Link list */
  .linklist-card {
    margin-bottom:16px;
  }
  .linklist-items {
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .linklist-item {
    border-radius:999px;
    border:1px solid #000;
    padding:10px 14px;
    text-align:center;
    font-size:.9rem;
    font-weight:500;
    cursor:pointer;
    text-decoration:none;
    color:#000;
    background:#fff;
  }

  /* Any question dropdown */
  .dropdown-card {
    margin-bottom:16px;
  }
  .dropdown-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    cursor:pointer;
    font-size:.9rem;
    font-weight:600;
  }
  .dropdown-header span {
    text-transform:uppercase;
    letter-spacing:.05em;
    font-size:.75rem;
  }
  .dropdown-chevron {
    font-size:1rem;
  }
  .dropdown-body {
    margin-top:12px;
    display:none;
  }
  .dropdown-card.open .dropdown-body {
    display:block;
  }

  .form-field {
    margin-bottom:10px;
  }
  .form-label {
    font-size:.8rem;
    margin-bottom:4px;
    display:block;
  }
  .form-input,
  .form-textarea {
    width:100%;
    border:1px solid #000;
    border-radius:8px;
    padding:8px;
    font-size:.85rem;
    background:#fff;
    color:#000;
  }
  .form-textarea {
    min-height:80px;
    resize:vertical;
  }
  .form-error {
    font-size:.75rem;
    color:#b00000;
    margin-bottom:6px;
  }
  .form-success {
    font-size:.8rem;
    color:#006400;
    margin-top:6px;
  }
  .form-submit-btn {
    width:100%;
    padding:8px 16px;
    border-radius:999px;
    border:1px solid #000;
    background:#000;
    color:#fff;
    font-size:.85rem;
    font-weight:600;
    cursor:pointer;
  }

  .recaptcha-box {
    margin:8px 0;
  }

  /* Produk section */
  .product-card {
    margin-bottom:16px;
  }
  .product-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:8px;
  }
  .product-title {
    font-size:.9rem;
    font-weight:600;
  }
  .product-categories {
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    font-size:.75rem;
  }
  .cat-pill {
    border-radius:999px;
    border:1px solid #000;
    padding:4px 10px;
    cursor:pointer;
    background:#fff;
  }
  .cat-pill.active {
    background:#000;
    color:#fff;
  }

  /* Slider: 2 item per layar */
  .sliderWrap {
    border-radius:16px;
    border:1px solid #000;
    padding:8px;
    background:#fff;
  }
  .slider {
    display:flex;
    gap:10px;
    overflow-x:auto;
    -webkit-overflow-scrolling:touch;
    scroll-snap-type:x mandatory;
    padding-bottom:6px;
  }
  .slider::-webkit-scrollbar {
    height:4px;
  }
  .slider::-webkit-scrollbar-thumb {
    background:#000;
  }
  .product-item {
    flex:0 0 calc(50% - 5px);
    min-width:0;
    scroll-snap-align:start;
    border-radius:12px;
    border:1px solid #000;
    overflow:hidden;
    background:#fff;
    display:flex;
    flex-direction:column;
  }
  .product-img {
    width:100%;
    aspect-ratio:4/5;
    object-fit:cover;
    border-bottom:1px solid #000;
  }
  .product-info {
    padding:8px;
    display:flex;
    flex-direction:column;
    gap:4px;
    flex:1;
  }
  .product-name {
    font-size:.8rem;
    font-weight:600;
    min-height:2.1em;
  }
  .product-price {
    font-size:.8rem;
  }
  .product-buy-btn {
    margin-top:auto;
    width:100%;
    border-radius:999px;
    border:1px solid #000;
    padding:6px 8px;
    font-size:.8rem;
    font-weight:600;
    background:#000;
    color:#fff;
    cursor:pointer;
  }

  /* Footer */
  .footer {
    margin-top:16px;
    font-size:.7rem;
    text-align:center;
    opacity:.8;
  }

  /* Popup marketing */
  .popup-backdrop {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:100;
  }
  .popup-backdrop.active {
    display:flex;
  }
  .popup-box {
    max-width:360px;
    width:90%;
    background:#fff;
    border-radius:16px;
    border:1px solid #000;
    padding:16px;
  }
  .popup-header {
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    margin-bottom:10px;
  }
  .popup-title {
    font-size:.95rem;
    font-weight:700;
  }
  .popup-close {
    border:none;
    background:transparent;
    font-size:1.1rem;
    cursor:pointer;
  }
  .popup-desc {
    font-size:.8rem;
    margin-bottom:10px;
  }
  .popup-success {
    display:none;
    font-size:.85rem;
  }
  .popup-success.active {
    display:block;
  }
  .popup-form.hidden {
    display:none;
  }

  a {
    color:inherit;
  }
</style>

<!-- ========== MARKUP ========== -->
<div class="biolink-body">
  <div class="biolink-wrap">

    <!-- PROFILE -->
    <section class="b-card profile">
      <img id="bioAvatar" class="profile-avatar" alt="Avatar">
      <div id="bioUsername" class="profile-username"></div>
      <div id="bioBio" class="profile-bio"></div>

      <!-- CTA Popup -->
      <button type="button" id="openPopupBtn" class="popup-cta-btn">
        Gratis
      </button>
    </section>

    <!-- SOCIAL ICONS -->
    <section id="socialRow" class="social-row"></section>

    <!-- SEARCH + BACK TO TOP (POSISI SEBELUM LINK LIST) -->
    <section class="b-card search-card">
      <label class="search-label" id="searchLabel">Cari disini</label>
      <input id="productSearchInput" type="search" class="search-input" placeholder="Ketik nama produk...">
      <button type="button" class="backToTopBtn" data-backtotop>â†‘ Kembali ke atas</button>
    </section>

    <!-- LINK LIST -->
    <section class="b-card linklist-card">
      <div class="search-label">Links</div>
      <div id="linkListContainer" class="linklist-items"></div>
    </section>

    <!-- ANY QUESTION DROPDOWN -->
    <section id="anyQuestionCard" class="b-card dropdown-card">
      <div class="dropdown-header" id="dropdownHeader">
        <span>Any question</span>
        <span class="dropdown-chevron" id="dropdownChevron">+</span>
      </div>
      <div class="dropdown-body">
        <form id="questionForm" novalidate>
          <div class="form-error" id="questionError"></div>

          <div class="form-field">
            <label class="form-label">Nama</label>
            <input type="text" id="qName" class="form-input" autocomplete="name">
          </div>

          <div class="form-field">
            <label class="form-label">Email *</label>
            <input type="email" id="qEmail" class="form-input" autocomplete="email">
          </div>

          <div class="form-field">
            <label class="form-label">WhatsApp *</label>
            <input type="tel" id="qWhatsapp" class="form-input" placeholder="contoh: 6281234567890">
          </div>

          <div class="form-field">
            <label class="form-label">Question</label>
            <textarea id="qQuestion" class="form-textarea" placeholder="Tulis pertanyaan kamu di sini..."></textarea>
          </div>

          <div class="recaptcha-box">
            <div id="questionCaptcha"></div>
          </div>

          <button type="submit" class="form-submit-btn">Send message</button>
          <div id="questionSuccess" class="form-success" style="display:none;">
            Pesan berhasil dikirim. Cek email / WhatsApp kamu.
          </div>
        </form>
      </div>
    </section>

    <!-- PRODUCTS -->
    <section class="b-card product-card">
      <div class="product-header">
        <div class="product-title">Produk</div>
        <div id="productCategories" class="product-categories"></div>
      </div>

      <div class="sliderWrap">
        <div id="productSlider" class="slider"></div>
      </div>
    </section>

    <!-- FOOTER -->
    <div id="bioFooter" class="footer"></div>

  </div>
</div>

<!-- POPUP MARKETING -->
<div id="marketingPopup" class="popup-backdrop">
  <div class="popup-box">
    <div class="popup-header">
      <div>
        <div id="popupTitle" class="popup-title"></div>
      </div>
      <button type="button" id="popupCloseBtn" class="popup-close">Ã—</button>
    </div>
    <div id="popupDesc" class="popup-desc"></div>

    <form id="popupForm" class="popup-form" novalidate>
      <div id="popupError" class="form-error"></div>

      <div class="form-field">
        <label class="form-label">Nama</label>
        <input type="text" id="pName" class="form-input" autocomplete="name">
      </div>

      <div class="form-field">
        <label class="form-label">Email *</label>
        <input type="email" id="pEmail" class="form-input" autocomplete="email">
      </div>

      <div class="form-field">
        <label class="form-label">WhatsApp *</label>
        <input type="tel" id="pWhatsapp" class="form-input" placeholder="contoh: 6281234567890">
      </div>

      <button type="submit" id="popupSubmitBtn" class="form-submit-btn">
        Kirim
      </button>
    </form>

    <div id="popupSuccess" class="popup-success">
      <div class="popup-title" style="margin-bottom:6px;">Terimakasih!</div>
      <div class="popup-desc">
        Biolink ini akan dikirim ke kamu, silahkan cek notifikasi WhatsApp atau email.
      </div>
    </div>
  </div>
</div>

<!-- ========== LOGIC + DATALAYER ========== -->
<script>
  // Inisialisasi dataLayer
  window.dataLayer = window.dataLayer || [];
  function dlPush(obj){
    try {
      window.dataLayer.push(obj);
    } catch(e) {}
  }

  function buildProfile(){
    var p = BIO_CONFIG.profile;
    var avatar = document.getElementById("bioAvatar");
    var usernameEl = document.getElementById("bioUsername");
    var bioEl = document.getElementById("bioBio");

    if(avatar && p.avatar){ avatar.src = p.avatar; }
    if(usernameEl){ usernameEl.textContent = p.username || ""; }
    if(bioEl){ bioEl.textContent = p.bio || ""; }
  }

  function buildSocials(){
    var row = document.getElementById("socialRow");
    if(!row) return;
    row.innerHTML = "";
    var activeSocials = (BIO_CONFIG.socials || []).filter(function(s){ return s.active && s.url; });

    if(!activeSocials.length){
      row.classList.add("hidden");
      return;
    }

    activeSocials.forEach(function(s){
      var a = document.createElement("a");
      a.href = s.url;
      a.target = "_blank";
      a.rel = "noopener";
      a.className = "social-link";
      a.dataset.platform = s.platform || "";
      a.dataset.label = s.label || "";

      var img = document.createElement("img");
      img.alt = s.label || s.platform || "social";
      img.src = s.icon || "";
      a.appendChild(img);

      a.addEventListener("click", function(){
        dlPush({
          event: "social_click",
          platform: s.platform,
          label: s.label,
          url: s.url,
          gtmId: BIO_CONFIG.gtmId
        });
      });

      row.appendChild(a);
    });

    return activeSocials;
  }

  function getEffectiveLinkList(activeSocials){
    var list = BIO_CONFIG.linkList || [];
    var activeLinks = list.filter(function(l){ return l.active && l.url; });

    if(activeLinks.length){
      return { items: activeLinks, usingSocialFallback: false };
    }

    // fallback pakai social media
    var socials = activeSocials || (BIO_CONFIG.socials || []).filter(function(s){ return s.active && s.url; });
    var mapped = socials.map(function(s){
      return {
        title: s.label || s.platform,
        url: s.url,
        icon: s.icon
      };
    });
    return { items: mapped, usingSocialFallback: true };
  }

  function buildLinkList(){
    var container = document.getElementById("linkListContainer");
    var socialRow = document.getElementById("socialRow");
    if(!container) return;

    container.innerHTML = "";

    var activeSocials = (BIO_CONFIG.socials || []).filter(function(s){ return s.active && s.url; });
    var effective = getEffectiveLinkList(activeSocials);
    var items = effective.items;

    if(effective.usingSocialFallback && socialRow){
      socialRow.classList.add("hidden");
    }

    items.forEach(function(item, idx){
      var a = document.createElement("a");
      a.href = item.url;
      a.target = "_blank";
      a.rel = "noopener";
      a.className = "linklist-item";
      a.textContent = item.title;

      a.addEventListener("click", function(){
        dlPush({
          event: "link_click",
          link_title: item.title,
          link_url: item.url,
          position: idx + 1,
          from_fallback_social: effective.usingSocialFallback,
          gtmId: BIO_CONFIG.gtmId
        });
      });

      container.appendChild(a);
    });
  }

  function buildProducts(){
    var catsContainer = document.getElementById("productCategories");
    var slider = document.getElementById("productSlider");
    if(!slider) return;

    var products = BIO_CONFIG.products || [];

    // kumpulin kategori unik
    var catsMap = {};
    products.forEach(function(p){
      if(p.category){
        catsMap[p.category] = true;
      }
    });
    var categories = Object.keys(catsMap);

    var state = {
      activeCategory: "ALL",
      searchTerm: ""
    };
    window.__productFilterState = state;

    function renderCategories(){
      if(!catsContainer) return;
      catsContainer.innerHTML = "";

      if(categories.length){
        var allBtn = document.createElement("button");
        allBtn.type = "button";
        allBtn.className = "cat-pill active";
        allBtn.textContent = "All";
        allBtn.addEventListener("click", function(){
          state.activeCategory = "ALL";
          updateProducts();
          updateCatsUI();
        });
        catsContainer.appendChild(allBtn);

        categories.forEach(function(cat){
          var btn = document.createElement("button");
          btn.type = "button";
          btn.className = "cat-pill";
          btn.textContent = cat;
          btn.dataset.cat = cat;
          btn.addEventListener("click", function(){
            state.activeCategory = cat;
            updateProducts();
            updateCatsUI();
            dlPush({
              event: "product_category_select",
              category: cat,
              gtmId: BIO_CONFIG.gtmId
            });
          });
          catsContainer.appendChild(btn);
        });
      }
    }

    function updateCatsUI(){
      if(!catsContainer) return;
      var btns = catsContainer.querySelectorAll(".cat-pill");
      btns.forEach(function(btn){
        var cat = btn.dataset.cat || "ALL";
        if(state.activeCategory === "ALL" && !btn.dataset.cat){
          btn.classList.add("active");
        } else if(state.activeCategory === cat){
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });
    }

    function updateProducts(){
      slider.innerHTML = "";
      var filtered = products.filter(function(p){
        var okCat = (state.activeCategory === "ALL") || (p.category === state.activeCategory);
        var okSearch = !state.searchTerm || (p.title || "").toLowerCase().indexOf(state.searchTerm) !== -1;
        return okCat && okSearch;
      });

      filtered.forEach(function(p, idx){
        var card = document.createElement("div");
        card.className = "product-item";

        var img = document.createElement("img");
        img.className = "product-img";
        img.src = p.image || "";
        img.alt = p.title || "Product";

        var info = document.createElement("div");
        info.className = "product-info";

        var name = document.createElement("div");
        name.className = "product-name";
        name.textContent = p.title || "";

        var price = document.createElement("div");
        price.className = "product-price";
        price.textContent = p.price || "";

        var btn = document.createElement("button");
        btn.type = "button";
        btn.className = "product-buy-btn";
        btn.textContent = "Buy";

        function handleClick(){
          dlPush({
            event: "product_click",
            product_title: p.title,
            product_price: p.price,
            product_url: p.url,
            product_category: p.category || "",
            position: idx + 1,
            gtmId: BIO_CONFIG.gtmId
          });
          window.open(p.url, "_blank");
        }

        img.addEventListener("click", handleClick);
        name.addEventListener("click", handleClick);
        btn.addEventListener("click", handleClick);

        info.appendChild(name);
        info.appendChild(price);
        info.appendChild(btn);
        card.appendChild(img);
        card.appendChild(info);
        slider.appendChild(card);
      });
    }

    renderCategories();
    updateCatsUI();
    updateProducts();

    // simpan fungsi update untuk dipakai oleh search
    window.__updateProductsFromSearch = function(searchTerm){
      state.searchTerm = (searchTerm || "").toLowerCase();
      updateProducts();
    };
  }

  function initSearch(){
    var input = document.getElementById("productSearchInput");
    var label = document.getElementById("searchLabel");
    if(label && BIO_CONFIG.productSearch && BIO_CONFIG.productSearch.label){
      label.textContent = BIO_CONFIG.productSearch.label;
    }

    if(!input) return;

    var lastTerm = "";
    input.addEventListener("input", function(){
      var term = input.value || "";
      lastTerm = term;
      if(typeof window.__updateProductsFromSearch === "function"){
        window.__updateProductsFromSearch(term);
      }
    });

    input.addEventListener("change", function(){
      dlPush({
        event: "product_search",
        term: lastTerm,
        gtmId: BIO_CONFIG.gtmId
      });
    });
  }

  function initBackToTop(){
    var btn = document.querySelector("[data-backtotop]");
    if(!btn) return;

    btn.addEventListener("click", function(){
      window.scrollTo({ top: 0, behavior: "smooth" });
      dlPush({
        event: "back_to_top_click",
        gtmId: BIO_CONFIG.gtmId
      });
    });

    window.addEventListener("scroll", function(){
      var y = window.scrollY || window.pageYOffset || 0;
      if(y > 300){
        document.body.classList.add("show-backtotop");
      } else {
        document.body.classList.remove("show-backtotop");
      }
    });
  }

  function validateEmail(email){
    return /\S+@\S+\.\S+/.test(email);
  }
  function validateWhatsapp(value){
    var digits = (value || "").replace(/\D/g, "");
    return digits.length >= 8;
  }

  function submitToGoogleForm(payload, callback){
    var formId = BIO_CONFIG.forms.googleFormId;
    if(!formId){
      if(callback){ callback(false); }
      return;
    }
    var url = "https://docs.google.com/forms/d/e/" + formId + "/formResponse";

    var fd = [];
    for(var k in payload){
      if(payload.hasOwnProperty(k)){
        fd.push(encodeURIComponent(k) + "=" + encodeURIComponent(payload[k]));
      }
    }
    var body = fd.join("&");

    fetch(url, {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
      },
      body: body
    }).then(function(){
      if(callback){ callback(true); }
    }).catch(function(){
      if(callback){ callback(false); }
    });
  }

  function initPopup(){
    var popupCfg = BIO_CONFIG.popup || {};
    var openBtn = document.getElementById("openPopupBtn");
    var popup = document.getElementById("marketingPopup");
    var closeBtn = document.getElementById("popupCloseBtn");
    var title = document.getElementById("popupTitle");
    var desc = document.getElementById("popupDesc");
    var form = document.getElementById("popupForm");
    var errorEl = document.getElementById("popupError");
    var successBox = document.getElementById("popupSuccess");
    var submitBtn = document.getElementById("popupSubmitBtn");

    if(!popupCfg.enabled){
      if(openBtn) openBtn.style.display = "none";
      return;
    }

    if(openBtn){
      openBtn.textContent = popupCfg.openCtaText || "Gratis";
      openBtn.style.backgroundColor = popupCfg.buttonColor || "#000";
      openBtn.style.color = popupCfg.buttonTextColor || "#fff";
    }

    if(title){ title.textContent = popupCfg.title || ""; }
    if(desc){ desc.textContent = popupCfg.description || ""; }
    if(submitBtn){ submitBtn.textContent = popupCfg.submitButtonText || "Kirim"; }

    function open(){
      popup.classList.add("active");
      dlPush({
        event: "popup_open",
        popup_type: "biolink_free",
        gtmId: BIO_CONFIG.gtmId
      });
    }
    function close(){
      popup.classList.remove("active");
    }

    if(openBtn){
      openBtn.addEventListener("click", open);
    }
    if(closeBtn){
      closeBtn.addEventListener("click", close);
    }
    popup.addEventListener("click", function(e){
      if(e.target === popup){ close(); }
    });

    if(form){
      form.addEventListener("submit", function(e){
        e.preventDefault();
        if(errorEl) errorEl.textContent = "";

        var name = document.getElementById("pName").value.trim();
        var email = document.getElementById("pEmail").value.trim();
        var wa = document.getElementById("pWhatsapp").value.trim();

        if(!email || !validateEmail(email)){
          if(errorEl) errorEl.textContent = "Masukkan email yang valid.";
          return;
        }
        if(!wa || !validateWhatsapp(wa)){
          if(errorEl) errorEl.textContent = "Masukkan nomor WhatsApp yang benar.";
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = "Mengirim...";

        var entry = BIO_CONFIG.forms.entry;
        var payload = {};
        payload[entry.name] = name;
        payload[entry.email] = email;
        payload[entry.whatsapp] = wa;

        dlPush({
          event: "popup_form_submit",
          email: email,
          whatsapp: wa,
          gtmId: BIO_CONFIG.gtmId
        });

        submitToGoogleForm(payload, function(success){
          submitBtn.disabled = false;
          submitBtn.textContent = popupCfg.submitButtonText || "Kirim";

          if(success){
            if(form) form.classList.add("hidden");
            if(successBox) successBox.classList.add("active");

            dlPush({
              event: "popup_form_submit_success",
              gtmId: BIO_CONFIG.gtmId
            });
          } else {
            if(errorEl) errorEl.textContent = "Gagal mengirim. Coba lagi nanti.";
            dlPush({
              event: "popup_form_submit_error",
              gtmId: BIO_CONFIG.gtmId
            });
          }
        });
      });
    }
  }

  function initAnyQuestion(){
    var card = document.getElementById("anyQuestionCard");
    var header = document.getElementById("dropdownHeader");
    var chevron = document.getElementById("dropdownChevron");
    var form = document.getElementById("questionForm");
    var errorEl = document.getElementById("questionError");
    var successEl = document.getElementById("questionSuccess");

    if(header){
      header.addEventListener("click", function(){
        var open = card.classList.toggle("open");
        chevron.textContent = open ? "âˆ’" : "+";
        dlPush({
          event: "any_question_toggle",
          open: open,
          gtmId: BIO_CONFIG.gtmId
        });
      });
    }

    if(form){
      form.addEventListener("submit", function(e){
        e.preventDefault();
        if(errorEl) errorEl.textContent = "";
        if(successEl) successEl.style.display = "none";

        var name = document.getElementById("qName").value.trim();
        var email = document.getElementById("qEmail").value.trim();
        var wa = document.getElementById("qWhatsapp").value.trim();
        var q = document.getElementById("qQuestion").value.trim();

        if(!email || !validateEmail(email)){
          if(errorEl) errorEl.textContent = "Email wajib dan harus valid.";
          return;
        }
        if(!wa || !validateWhatsapp(wa)){
          if(errorEl) errorEl.textContent = "WhatsApp wajib dan harus benar.";
          return;
        }

        // reCAPTCHA check
        var siteKey = BIO_CONFIG.forms.recaptchaSiteKey;
        if(siteKey && window.grecaptcha && typeof window.__questionCaptchaId !== "undefined"){
          var token = grecaptcha.getResponse(window.__questionCaptchaId);
          if(!token){
            if(errorEl) errorEl.textContent = "Tolong centang captcha (buktikan kamu bukan robot).";
            dlPush({
              event: "any_question_recaptcha_fail",
              gtmId: BIO_CONFIG.gtmId
            });
            return;
          }
        }

        var entry = BIO_CONFIG.forms.entry;
        var payload = {};
        payload[entry.name] = name;
        payload[entry.email] = email;
        payload[entry.whatsapp] = wa;
        payload[entry.question] = q;

        dlPush({
          event: "any_question_submit",
          email: email,
          whatsapp: wa,
          gtmId: BIO_CONFIG.gtmId
        });

        submitToGoogleForm(payload, function(success){
          if(success){
            if(successEl) successEl.style.display = "block";
            form.reset();
            if(window.grecaptcha && typeof window.__questionCaptchaId !== "undefined"){
              grecaptcha.reset(window.__questionCaptchaId);
            }
            dlPush({
              event: "any_question_submit_success",
              gtmId: BIO_CONFIG.gtmId
            });
          } else {
            if(errorEl) errorEl.textContent = "Gagal mengirim. Coba lagi nanti.";
            dlPush({
              event: "any_question_submit_error",
              gtmId: BIO_CONFIG.gtmId
            });
          }
        });
      });
    }
  }

  function initFooter(){
    var el = document.getElementById("bioFooter");
    if(!el) return;
    el.textContent = (BIO_CONFIG.footer && BIO_CONFIG.footer.text) || "";
  }

  function pushInitialDataLayer(){
    var activeSocials = (BIO_CONFIG.socials || []).filter(function(s){ return s.active && s.url; });
    var effective = getEffectiveLinkList(activeSocials);

    dlPush({
      event: "biolink_pageview",
      gtmId: BIO_CONFIG.gtmId,
      profile: {
        username: BIO_CONFIG.profile && BIO_CONFIG.profile.username,
        bio: BIO_CONFIG.profile && BIO_CONFIG.profile.bio
      },
      social_links: activeSocials.map(function(s){
        return {
          platform: s.platform,
          label: s.label,
          url: s.url
        };
      }),
      link_list: effective.items.map(function(l){
        return {
          title: l.title,
          url: l.url
        };
      }),
      products: (BIO_CONFIG.products || []).map(function(p, i){
        return {
          title: p.title,
          url: p.url,
          price: p.price,
          category: p.category,
          position: i + 1
        };
      })
    });
  }

  document.addEventListener("DOMContentLoaded", function(){
    buildProfile();
    var socials = buildSocials();
    buildLinkList();
    buildProducts();
    initSearch();
    initBackToTop();
    initPopup();
    initAnyQuestion();
    initFooter();
    pushInitialDataLayer();
  });

  // reCAPTCHA explicit render
  function renderRecaptcha(){
    var siteKey = BIO_CONFIG.forms && BIO_CONFIG.forms.recaptchaSiteKey;
    if(!siteKey || !window.grecaptcha) return;
    try {
      window.__questionCaptchaId = grecaptcha.render("questionCaptcha", {
        sitekey: siteKey
      });
    } catch(e){}
  }
</script>

<!-- reCAPTCHA (JANGAN LUPA ISI SITE KEY DI CONFIG) -->
<script src="https://www.google.com/recaptcha/api.js?onload=renderRecaptcha&render=explicit" async defer></script>
